---
layout: post
title: "兄弟会官网项目开发流程"
date: 2019-12-09 18:26:40
category: 'notes'
tags:
- Python
- 项目
- Django
---
* content
{:toc}

Django兄弟会官网项目开发流程











  









# 项目描述
### 项目技术
1. [Python3.7](https://docs.python.org/3.7/)  
2. [Django2.2](https://docs.djangoproject.com/en/3.0/)  
3. [vue(js框架)](https://cn.vuejs.org/v2/guide/)  
4. [Materialize(css框架)](http://www.materializecss.cn/getting-started.html)  


### 包文件
```
Django              2.2.9  
django-cors-headers 3.2.0  
mysqlclient         1.4.6  
pip                 19.0.3  
pytz                2019.3  
setuptools          40.8.0  
sqlparse            0.3.0  
```

# 需求分析
### 首页  
    轮播图  
    兄弟会介绍  
        兄弟会的初衷-打造具备交付能力的程序员  
        兄弟会宣传介绍文案  
    兄弟会与传统就业班区别  
        主要是教学模式的对比  
        要体现出兄弟会与传统就业班的优势  
    师资力量  
        正常介绍即可  
    就业喜报  
        如果有就写  
    学科介绍  
        兄弟会4大学科基本介绍
        	Python
        	java
        	PHP
        	H5
        图文介绍  

### 课程介绍  
    培训课程，具体学科介绍  
    兄弟会具体学科及分级介绍  
    兄弟会解决了什么问题(需要牛逼的文案)  
    重点突出兄弟会课程体系与传统培训体系的不同(需要牛逼的文案)  
    学习的苦VS生活的苦(不吃学习的苦,就要吃生活的苦,文案牛逼一点)  

### 教学特色  
    办学理念-具有真实交付能力的程序员
    项目驱动式项目(每阶段都有可锻炼的项目)  
    企业级项目经理指导   
    真实的企业级商业项目全程开发
    学习经验分享
    企业文化培训-培养身心健康的程序员  

### 学员风采  
    学员采访视频 
    学员感言  
    个人博客  
    团建活动  
    我们的作品  

### 常见问题  
    入学条件 
    	分期贷款学员需要慎重考虑,因为需要还贷款
    	编程基础
    入学流程  
    	正常流程
    开班计划 
    	兄弟连学校制定
    学费标准 
    	学校制定

### 就业喜报  
    尽量写真实的  

### 关于我们  
    兄弟连介绍  
    兄弟会详细介绍(沈阳)
    联系方式等  

### 公共部分  
    头部导航  
    轮播图  
    页脚
    	友情链接  
    	二维码
    	联系电话



# 编码思路
### 整体架构(三端分离)
```
1. 后台页面:通过form表单发送post请求  
2. 后台接口:接收post请求,对数据库进行增删改查操作(给后台页面返回json状态码)  
3. 前台接口:从数据库中增删改查(给前台页面返回json数据)  
4. 前台页面:通过axios接收接口数据(就是访问路由),返回到页面中遍历出来  
```

### 后台页面端(xdh_admin_page)
查询
```
1. axios.get接收接口返回的数据
2. v-for遍历接到的接口数据
3. v-bind绑定属性(如图片`:src="item.link+item.img"`)
4. v-text或 { { } } 设置标签的内容
```

增加
```
1. v-bind绑定属性(如`:action="addUrl"`)
2. v-model双向数据绑定(如`v-model="link"`)
3. v-on绑定函数(如`@change="IT"`)
4. post方法form表单提交数据
```

删除
```

```

修改
```

```

### 接口端(xdh_vue_django)
#### 后台接口(bgapi)
查询
```python
def list(request):
    u_dict = all_data(Blog)
    return JsonResponse(u_dict)

def all_data(a_model_class, order="id"):
    # 先定义一个字典类型的返回内容
    u_list = {}
    # 要加的key
    i = 0
    # 查询模型
    objs = a_model_class.objects.order_by(order)
    # 遍历模型
    for obj in objs:
        # 转换成当前的查询集字典
        curr_data = model_to_dict(obj)
        # 判断有没有key是img的
        if "img" in curr_data.keys():
            # 要是有就拼settings里面的静态文件路径
            curr_data["img"] = settings.BASE_URL + curr_data["img"]
            # 头像图片
        if "avator_img" in curr_data.keys():
            curr_data["avator_img"] = settings.BASE_URL + curr_data["avator_img"]
        # 将处理后的当前数据赋值给字典
        u_list[i] = curr_data
        # 更新key的值
        i += 1
    # 返回数据
    return u_list
```

增加
```python
def add(request):
    # 定义返回数据
    u_dict = {

    }
    # 判断请求方式
    if (request.method == 'POST'):
        try:
            # 开始处理图片
            # 1.获取表单内容
            data = request.POST.dict()
            print(data)
            # 2. 获取表单中的文件
            file = request.FILES.get('file', None)
            print("file",file)
            # 3. 执行保存文件,并返回文件路径
            # save_file ---> 自定义函数
            path = save_file(file)
            print("path:",path)
            # 构建img字段数据
            data["img"] = path
            # data.pop("file")
            # 保存数据
            Blog(**data).save()
            # 返回数据内容
            u_dict = {
                "msg": "ok",
                "code": "200"
            }
        except:
            u_dict = {
                "msg": "error",
                "code": "500"
            }
    if (request.method == 'GET'):
        u_dict = {
            "msg": "no",
            "code": "666"
        }
    return JsonResponse(u_dict)
	
def save_file(file):
    if file:
        # 上传了头像
        import hashlib
        # 待加密信息(随机数)
        ran_str = str(random.randint(0, 9999999))
        # 创建md5对象
        hl = hashlib.md5()
        to_md5_str = str(time.time())+ran_str
        # Tips
        # 此处必须声明encode
        # 若写法为hl.update(str)  报错为： Unicode-objects must be encoded before hashing
        hl.update(to_md5_str.encode(encoding='utf-8'))
        # 加密完的md5字符串
        md5_str = hl.hexdigest()
        # 文件扩展名
        file_extend_name = file.name.split('.').pop()
        # 拼接文件名
        filename = md5_str + '.' + file_extend_name

        with open(f'./static/uploads/' + filename, 'wb+') as f:
            f.write(file.read())
        # with open(f'./media/uploads/' + filename, 'wb+') as fp:
        #     fp.write(file.read())
        return filename
    else:
        return ""
```

删除
```python
def delete(request):
    try:
        # 尝试删除
        id = request.GET.get("id")
        obj = Blog.objects.get(id=id)
        obj.delete()
        u_dict = {
            "msg": "ok",
            "code": "200"
        }
    except:
        u_dict = {
            "msg": "error",
            "code": "500"
        }
    return JsonResponse(u_dict)
```

修改
```python
def edit(request):
    if (request.method == 'POST'):
        try:
            # 删除数据
            delete(request)
            # 删除文件

            # 新增数据
            add(request)
            # 成功状态码
            u_dict = {
                "msg": "ok",
                "code": "200"
            }
        except:
            # 失败状态码
            u_dict = {
                "msg": "error",
                "code": "500"
            }
    if (request.method == 'GET'):
        # 请求方式不对状态码
        u_dict = {
            "msg": "no",
            "code": "666"
        }
    return JsonResponse(u_dict)
```

#### 前台接口(api)
```python
def blog(request):
	1. filter从数据库中查数据  
    objs = Blog.objects.filter()
    u_list = {}
    i = 0
	2. 然后遍历，目的是变成单条数据，能转化成字典(键是字段，值是数据) 
    for obj in objs:
        curr_data = model_to_dict(obj)
        curr_data.pop("id")
        curr_data.pop("is_del")
        curr_data["img"] = settings.BASE_URL + curr_data["img"]
		3. 然后再循环给每个字典加上键(键是0123，值是字典)，形成双层字典  
        u_list[i] = curr_data
        i += 1
	4. 然后把字典转化成json返回  
    return JsonResponse(u_list)
```

### 前台页面端(xdh_front_page)
```js
// 学员风采的js文件
var vm = new Vue({
	el: '#app',
	data: {
		baseUrl: "http://192.168.1.107:8000",
		img: "",
		studentsay: "",
		blog: "",
		works: "",
		video: "",
	},
	methods: {},
	created() {
		var that = this;
		//毕业学员评价
		axios.get(this.baseUrl + "/api/xyfc/video/")
			.then(function(response) {
				// console.log(response.data[0])
				that.video = response.data
			});
		//我们的作品
		axios.get(this.baseUrl + "/api/xyfc/works/")
			.then(function(response) {
				// console.log(response.data[0])
				that.works = response.data
			});
		//学员感言
		axios.get(this.baseUrl + "/api/xyfc/studentsay/")
			.then(function(response) {
				// console.log(response.data)
				that.studentsay = response.data
			});
		//个人博客
		axios.get(this.baseUrl + "/api/xyfc/blog/")
			.then(function(response) {
				// console.log(response.data[0])
				that.blog = response.data
			});
	},
})
```

### 组件
导航
分类
搜索
分页





