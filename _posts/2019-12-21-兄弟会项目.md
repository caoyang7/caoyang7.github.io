---
layout: post
title: "兄弟会官网项目总结"
date: 2019-12-21 18:26:40
category: 'notes'
tags:
- Python
- Django
- Vue
- 项目
---
* content
{:toc}

Django兄弟会官网项目总结











  








# 项目简介
### 项目描述
兄弟会官网管理系统
MVT架构
三端分离  
vue没用脚手架


### 项目技术
1. [Python3.7](https://docs.python.org/3.7/)  
2. [Django2.2](https://docs.djangoproject.com/en/2.2/)  
3. [vue2.9.6(js框架)](https://cn.vuejs.org/v2/guide/)  
4. [Materialize(css框架)](http://www.materializecss.cn/getting-started.html)  
5. [MySQL5.7](https://dev.mysql.com/doc/refman/5.7/en/)

### 包文件
```
Django              2.2.9  
django-cors-headers 3.2.0  
mysqlclient         1.4.6  
pip                 19.0.3  
pytz                2019.3  
setuptools          40.8.0  
sqlparse            0.3.0  
```

### 项目分工
```
小明：需求分析，建库，前后台接口，合并项目
齐健：需求分析，关于我们，课程介绍，后台增删改查页面，路由
陈赞：需求分析，首页，常见问题，后台增删改查页面
斌哥：需求分析，办学特色，技术社区，后台增删改查页面
我：需求分析，学员风采，文件上传，后台接口，封组件(导航，分页，搜索，分类下拉选框)
```

# 需求分析
### 首页  
    轮播图  
    兄弟会介绍  
        兄弟会的初衷-打造具备交付能力的程序员  
        兄弟会宣传介绍文案  
    兄弟会与传统就业班区别  
        主要是教学模式的对比  
        要体现出兄弟会与传统就业班的优势  
    师资力量  
        正常介绍即可  
    就业喜报  
        如果有就写  
    学科介绍  
        兄弟会4大学科基本介绍
        	Python
        	java
        	PHP
        	H5
        图文介绍  

### 课程介绍  
    培训课程，具体学科介绍  
    兄弟会具体学科及分级介绍  
    兄弟会解决了什么问题(需要牛逼的文案)  
    重点突出兄弟会课程体系与传统培训体系的不同(需要牛逼的文案)  
    学习的苦VS生活的苦(不吃学习的苦,就要吃生活的苦,文案牛逼一点)  

### 教学特色  
    办学理念-具有真实交付能力的程序员
    项目驱动式项目(每阶段都有可锻炼的项目)  
    企业级项目经理指导   
    真实的企业级商业项目全程开发
    学习经验分享
    企业文化培训-培养身心健康的程序员  

### 学员风采  
    学员采访视频 
    学员感言  
    个人博客  
    团建活动  
    我们的作品  

### 常见问题  
    入学条件 
    	分期贷款学员需要慎重考虑,因为需要还贷款
    	编程基础
    入学流程  
    	正常流程
    开班计划 
    	兄弟连学校制定
    学费标准 
    	学校制定

### 就业喜报  
    尽量写真实的  

### 关于我们  
    兄弟连介绍  
    兄弟会详细介绍(沈阳)
    联系方式等  

### 公共部分  
    头部导航  
    轮播图  
    页脚
    	友情链接  
    	二维码
    	联系电话

# 编码实现
### 三端分离
```
1. 后台页面:通过form表单发送post请求  
2. 后台接口:接收post请求,对数据库进行增删改查操作(给后台页面返回json状态码)  
3. 前台接口:从数据库中增删改查(给前台页面返回json数据)  
4. 前台页面:通过axios接收接口数据(就是访问路由),返回到页面中遍历出来  
```

### 后台页面端(xdh_admin_page)
查询
```
1. axios.get接收接口返回的数据
2. v-for遍历接到的接口数据
3. v-bind绑定属性(如图片`:src="item.link+item.img"`)
4. v-text或 { { } } 设置标签的内容
```

增加
```
1. v-bind绑定属性(如`:action="addUrl"`)
2. v-model双向数据绑定(如`v-model="link"`)
3. v-on绑定函数(如`@change="IT"`)
4. post方法form表单提交数据
```

删除
```

```

修改
```

```

### 接口端(xdh_vue_django)
#### 后台接口(bgapi)
查询
```python
def list(request):
    u_dict = all_data(Blog)
    return JsonResponse(u_dict)

def all_data(a_model_class, order="id"):
    # 先定义一个字典类型的返回内容
    u_list = {}
    # 要加的key
    i = 0
    # 查询模型
    objs = a_model_class.objects.order_by(order)
    # 遍历模型
    for obj in objs:
        # 转换成当前的查询集字典
        curr_data = model_to_dict(obj)
        # 判断有没有key是img的
        if "img" in curr_data.keys():
            # 要是有就拼settings里面的静态文件路径
            curr_data["img"] = settings.BASE_URL + curr_data["img"]
            # 头像图片
        if "avator_img" in curr_data.keys():
            curr_data["avator_img"] = settings.BASE_URL + curr_data["avator_img"]
        # 将处理后的当前数据赋值给字典
        u_list[i] = curr_data
        # 更新key的值
        i += 1
    # 返回数据
    return u_list
```

增加
```python
def add(request):
    # 定义返回数据
    u_dict = {

    }
    # 判断请求方式
    if (request.method == 'POST'):
        try:
            # 开始处理图片
            # 1.获取表单内容
            data = request.POST.dict()
            print(data)
            # 2. 获取表单中的文件
            file = request.FILES.get('file', None)
            print("file",file)
            # 3. 执行保存文件,并返回文件路径
            # save_file ---> 自定义函数
            path = save_file(file)
            print("path:",path)
            # 构建img字段数据
            data["img"] = path
            # data.pop("file")
            # 保存数据
            Blog(**data).save()
            # 返回数据内容
            u_dict = {
                "msg": "ok",
                "code": "200"
            }
        except:
            u_dict = {
                "msg": "error",
                "code": "500"
            }
    if (request.method == 'GET'):
        u_dict = {
            "msg": "no",
            "code": "666"
        }
    return JsonResponse(u_dict)
	
def save_file(file):
    if file:
        # 上传了头像
        import hashlib
        # 待加密信息(随机数)
        ran_str = str(random.randint(0, 9999999))
        # 创建md5对象
        hl = hashlib.md5()
        to_md5_str = str(time.time())+ran_str
        # Tips
        # 此处必须声明encode
        # 若写法为hl.update(str)  报错为： Unicode-objects must be encoded before hashing
        hl.update(to_md5_str.encode(encoding='utf-8'))
        # 加密完的md5字符串
        md5_str = hl.hexdigest()
        # 文件扩展名
        file_extend_name = file.name.split('.').pop()
        # 拼接文件名
        filename = md5_str + '.' + file_extend_name

        with open(f'./static/uploads/' + filename, 'wb+') as f:
            f.write(file.read())
        # with open(f'./media/uploads/' + filename, 'wb+') as fp:
        #     fp.write(file.read())
        return filename
    else:
        return ""
```

删除
```python
def delete(request):
    try:
        # 尝试删除
        id = request.GET.get("id")
        obj = Blog.objects.get(id=id)
        obj.delete()
        u_dict = {
            "msg": "ok",
            "code": "200"
        }
    except:
        u_dict = {
            "msg": "error",
            "code": "500"
        }
    return JsonResponse(u_dict)
```

修改
```python
def edit(request):
    if (request.method == 'POST'):
        try:
            # 删除数据
            delete(request)
            # 删除文件

            # 新增数据
            add(request)
            # 成功状态码
            u_dict = {
                "msg": "ok",
                "code": "200"
            }
        except:
            # 失败状态码
            u_dict = {
                "msg": "error",
                "code": "500"
            }
    if (request.method == 'GET'):
        # 请求方式不对状态码
        u_dict = {
            "msg": "no",
            "code": "666"
        }
    return JsonResponse(u_dict)
```

#### 前台接口(api)
```python
def blog(request):
	1. filter从数据库中查数据  
    objs = Blog.objects.filter()
    u_list = {}
    i = 0
	2. 然后遍历，目的是变成单条数据，能转化成字典(键是字段，值是数据) 
    for obj in objs:
        curr_data = model_to_dict(obj)
        curr_data.pop("id")
        curr_data.pop("is_del")
        curr_data["img"] = settings.BASE_URL + curr_data["img"]
		3. 然后再循环给每个字典加上键(键是0123，值是字典)，形成双层字典  
        u_list[i] = curr_data
        i += 1
	4. 然后把字典转化成json返回  
    return JsonResponse(u_list)
```

### 前台页面端(xdh_front_page)
```js
// 学员风采的js文件
var vm = new Vue({
	el: '#app',
	data: {
		baseUrl: "http://192.168.1.107:8000",
		img: "",
		studentsay: "",
		blog: "",
		works: "",
		video: "",
	},
	methods: {},
	created() {
		var that = this;
		//毕业学员评价
		axios.get(this.baseUrl + "/api/xyfc/video/")
			.then(function(response) {
				// console.log(response.data[0])
				that.video = response.data
			});
		//我们的作品
		axios.get(this.baseUrl + "/api/xyfc/works/")
			.then(function(response) {
				// console.log(response.data[0])
				that.works = response.data
			});
		//学员感言
		axios.get(this.baseUrl + "/api/xyfc/studentsay/")
			.then(function(response) {
				// console.log(response.data)
				that.studentsay = response.data
			});
		//个人博客
		axios.get(this.baseUrl + "/api/xyfc/blog/")
			.then(function(response) {
				// console.log(response.data[0])
				that.blog = response.data
			});
	},
})
```

### 组件
导航
```vue
<!-- App.vue -->
<template>
  <div id="app">
    <header-nav></header-nav>
  </div>
</template>
<script>
  import headerNav from '@/components/header-nav'
export default {
  name: 'App',
  components:{
    headerNav
  }
}
</script>
<style>
</style>
  
<!-- components/header-nav.vue -->
<template>
  <div class="header">
  	<!-- 顶部导航栏 -->
  	<div class="container">
  		<nav class="z-depth-0 transparent">
  			<div class="nav-wrapper">
  				<a href="javascript:;" class="brand-logo"></a>
  				<ul class="right hide-on-med-and-down">
  					<li><a href="">首页</a></li>
  					<li><a href="">课程详情</a></li>
  					<li><a href="">学员风采</a></li>
  					<li><a href="">就业喜报</a></li>
  					<li><a href="">技术社区</a></li>
  					<li><a href="">关于我们</a></li>
  				</ul>
  			</div>
  		</nav>
  	</div>
  </div>
</template>
<script>
</script>
<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
</style>
  
<!-- router/index.js -->
import Vue from 'vue'
import Router from 'vue-router'
import '@/assets/css/common.css'
import '@/assets/css/materialize.css'
Vue.use(Router)
export default new Router({
  routes: []
})
```


分页
```python


```

分类下拉选框
```

```

搜索
```

```

### 路由
index.html
```html
<div id="app"></div>
<script src="assets/js/index.js"></script>
```

index.js
```vue
// 1.封组件
var banner = {
	template: `<div>banner图</div>`
};
var community = {
	template: `<div>社区资源</div>`
};

// 2.创建router对象
var router = new VueRouter({
    //配置路由对象
    routes:[
        //路由匹配的规则
        {
            path:"/banner",
            component:banner
        },
        {
            path:"/community",
            component:community,
        },
    ]
});
var App = {
	template: `
			<div>
				<div class="am-g tpl-g">
					<!-- 头部 -->
					<header>
						<!-- logo -->
						<div class="am-fl tpl-header-logo">
							<a href="javascript:;">
								<img src="assets/img/logo.png" alt="">
							</a>
						</div>
						<!-- 右侧内容 -->
						<div class="tpl-header-fluid">
							<!-- 侧边切换 -->
							<div class="am-fl tpl-header-switch-button am-icon-list">
								<span>
								</span>
							</div>
							<!-- 搜索 -->
							<div class="am-fl tpl-header-search">
								<form class="tpl-header-search-form" action="javascript:;">
									<button class="tpl-header-search-btn am-icon-search">
									</button>
									<input class="tpl-header-search-box" type="text" placeholder="搜索内容...">
								</form>
							</div>
							<!-- 其它功能-->
							<div class="am-fr tpl-header-navbar">
								<ul>
									<!-- 欢迎语 -->
									<li class="am-text-sm tpl-header-navbar-welcome">
										<a href="javascript:;">
											欢迎你,
											<span>
												Amaze UI
											</span>
										</a>
									</li>
									<!-- 新邮件 -->
									<li class="am-dropdown tpl-dropdown" data-am-dropdown>
										<a href="javascript:;" class="am-dropdown-toggle tpl-dropdown-toggle"
										data-am-dropdown-toggle>
											<i class="am-icon-envelope">
											</i>
											<span class="am-badge am-badge-success am-round item-feed-badge">
												4
											</span>
										</a>
										<!-- 弹出列表 -->
										<ul class="am-dropdown-content tpl-dropdown-content">
											<li class="tpl-dropdown-menu-messages">
												<a href="javascript:;" class="tpl-dropdown-menu-messages-item am-cf">
													<div class="menu-messages-ico">
														<img src="assets/img/user04.png" alt="">
													</div>
													<div class="menu-messages-time">
														3小时前
													</div>
													<div class="menu-messages-content">
														<div class="menu-messages-content-title">
															<i class="am-icon-circle-o am-text-success">
															</i>
															<span>
																夕风色
															</span>
														</div>
														<div class="am-text-truncate">
															Amaze UI 的诞生，依托于 GitHub 及其他技术社区上一些优秀的资源；Amaze UI 的成长，则离不开用户的支持。
														</div>
														<div class="menu-messages-content-time">
															2016-09-21 下午 16:40
														</div>
													</div>
												</a>
											</li>
											<li class="tpl-dropdown-menu-messages">
												<a href="javascript:;" class="tpl-dropdown-menu-messages-item am-cf">
													<div class="menu-messages-ico">
														<img src="assets/img/user02.png" alt="">
													</div>
													<div class="menu-messages-time">
														5天前
													</div>
													<div class="menu-messages-content">
														<div class="menu-messages-content-title">
															<i class="am-icon-circle-o am-text-warning">
															</i>
															<span>
																禁言小张
															</span>
														</div>
														<div class="am-text-truncate">
															为了能最准确的传达所描述的问题， 建议你在反馈时附上演示，方便我们理解。
														</div>
														<div class="menu-messages-content-time">
															2016-09-16 上午 09:23
														</div>
													</div>
												</a>
											</li>
											<li class="tpl-dropdown-menu-messages">
												<a href="javascript:;" class="tpl-dropdown-menu-messages-item am-cf">
													<i class="am-icon-circle-o">
													</i>
													进入列表…
												</a>
											</li>
										</ul>
									</li>
									<!-- 新提示 -->
									<li class="am-dropdown" data-am-dropdown>
										<a href="javascript:;" class="am-dropdown-toggle" data-am-dropdown-toggle>
											<i class="am-icon-bell">
											</i>
											<span class="am-badge am-badge-warning am-round item-feed-badge">
												5
											</span>
										</a>
										<!-- 弹出列表 -->
										<ul class="am-dropdown-content tpl-dropdown-content">
											<li class="tpl-dropdown-menu-notifications">
												<a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
													<div class="tpl-dropdown-menu-notifications-title">
														<i class="am-icon-line-chart">
														</i>
														<span>
															有6笔新的销售订单
														</span>
													</div>
													<div class="tpl-dropdown-menu-notifications-time">
														12分钟前
													</div>
												</a>
											</li>
											<li class="tpl-dropdown-menu-notifications">
												<a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
													<div class="tpl-dropdown-menu-notifications-title">
														<i class="am-icon-star">
														</i>
														<span>
															有3个来自人事部的消息
														</span>
													</div>
													<div class="tpl-dropdown-menu-notifications-time">
														30分钟前
													</div>
												</a>
											</li>
											<li class="tpl-dropdown-menu-notifications">
												<a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
													<div class="tpl-dropdown-menu-notifications-title">
														<i class="am-icon-folder-o">
														</i>
														<span>
															上午开会记录存档
														</span>
													</div>
													<div class="tpl-dropdown-menu-notifications-time">
														1天前
													</div>
												</a>
											</li>
											<li class="tpl-dropdown-menu-notifications">
												<a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
													<i class="am-icon-bell">
													</i>
													进入列表…
												</a>
											</li>
										</ul>
									</li>
									<!-- 退出 -->
									<li class="am-text-sm">
										<a href="javascript:;">
											<span class="am-icon-sign-out">
											</span>
											退出
										</a>
									</li>
								</ul>
							</div>
						</div>
					</header>
					<!-- 风格切换 -->
					<div class="tpl-skiner">
						<div class="tpl-skiner-toggle am-icon-cog">
						</div>
						<div class="tpl-skiner-content">
							<div class="tpl-skiner-content-title">
								选择主题
							</div>
							<div class="tpl-skiner-content-bar">
								<span class="skiner-color skiner-white" data-color="theme-white">
								</span>
								<span class="skiner-color skiner-black" data-color="theme-black">
								</span>
							</div>
						</div>
					</div>
					<!-- 侧边导航栏 -->
					<div class="left-sidebar">
						<!-- 用户信息 -->
						<div class="tpl-sidebar-user-panel">
							<div class="tpl-user-panel-slide-toggleable">
								<div class="tpl-user-panel-profile-picture">
									<img src="assets/img/user04.png" alt="">
								</div>
								<span class="user-panel-logged-in-text">
									<i class="am-icon-circle-o am-text-success tpl-user-panel-status-icon">
									</i>
									禁言小张
								</span>
								<a href="javascript:;" class="tpl-user-panel-action-link">
									<span class="am-icon-pencil">
									</span>
									账号设置
								</a>
							</div>
						</div>
						<!-- 菜单 -->
						<ul class="sidebar-nav">
							<li class="sidebar-nav-heading">
								Components
								<span class="sidebar-nav-heading-info">
									附加组件
								</span>
							</li>
							<li class="sidebar-nav-link" style="margin-top:-25px;">
								<a href="index.html">
									<router-link style="margin-top:-10px;" to="/banner">
										<i class="am-icon-home sidebar-nav-link-logo">
										</i>
										banner图
									</router-link>
									<router-link style="margin-top:-10px;" to="/community">
										<i class="am-icon-home sidebar-nav-link-logo">
										</i>
										社区资源
									</router-link>
								</a>
							</li>
						</ul>
					</div>
					<div class="tpl-content-wrapper">
						<router-view>
						</router-view>
					</div>
				</div>
			</div>
			</div>
			`
};

// 3.创建vue实例
var vm = new Vue({
    el:'#app',
    data(){
        return{
        }
    },
    components:{
        App
    },
    router,
    template:`<App/>`
})
```


### 接口返回值
格式
```
status：状态码，根据status判断提示信息
info：提示信息
data：返回数据
```

正确
```python
def success_response(u_dict):
    '''
    正确返回数据 过滤器
    :param u_dict: 返回的数据主体内容
    :return: 嵌套后的数据
    '''
    u_dict = {
        "status": "200",
        "info": "返回信息成功!",
        "data": u_dict
    }
    return u_dict
```

错误
```python
def error_response(u_dict, err_info):
    '''
    返回错误json
    :param u_dict: json返回的主要内容
    :param err_info: 错误提示信息
    :return:
    '''
    u_dict = {
        "status": "500",
        "info": err_info,
        "data": u_dict
    }
    return u_dict
```

接口通，逻辑错误，比如没写参数
```
status:500
info:调用的时候传个参数告诉你哪错了
data:
```

语法错误(接口错了),data返回内容框架自定义，可以把错误提示以json形式返回
```
status:500
info:
data:{
	
}
```






